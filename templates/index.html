<html>

<head>
    <title>Kirpputori</title>
</head>

<body>
  <h1>Kirpputori</h1>
  {% if session.username %}
    <p>Tervetuloa, {{ session.username }}! UID:{{ session.uid }}</p>
    <p><a href="/logout">Kirjaudu Ulos</a>
    <p><a href="/new_item">Uusi ilmoitus</a></p>
    <p><a href="/user/{{ session.uid }}">Käyttäjäsivu</a></p>
  {% else %}
    <p><a href="/login">Kirjaudu Sisään</a> | <a href="/register">Luo Tunnus</a></p>
  {% endif %}
  
  <form action="/" method="get">
    <input type="text" name="query" placeholder="Hae ilmoituksia" value="{{ query or '' }}">
    <input type="submit", value="Hae">
  </form>
  
  <h2>Ilmoitukset</h2>

  {% for category in categories %}
    <h3>{{ category.name }} ({{ category_items[category.name] | length }})</h3>
    {% if category_items[category.name] %}
        <ul>
        {% for item in category_items[category.name] %}
            <li>
                <a href="/item/{{ item.id }}">{{ item.title }}</a>— {{ item.price }} €
                {% if session.uid == item.uid %}
                    <a href="/edit_item/{{ item.id }}">Muokkaa</a>
                    <a href="/delete_item/{{ item.id }}">Poista</a>
                {% endif %}
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p><i>Ei ilmoituksia tässä kategoriassa.</i></p>
    {% endif %}
  {% endfor %}

</body>

</html>